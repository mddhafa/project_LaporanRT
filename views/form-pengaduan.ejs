<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RT Kampung Durian Roboh</title>
    <link rel="stylesheet" href="/form-pengaduan.css">
</head>

<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Logo -->
        <div class="logo">
            <img src="/image/logotni.png" alt="Logo" class="logo-img">
        </div>


        <div class="sidebar-content">
            <!-- Navigation Links -->
            <a href="/index" title="Beranda" id="homeLink">
                <!-- Home Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="27" height="25" viewBox="0 0 27 25" fill="none">
                    <path
                        d="M13.5 3.95588L20.25 10.5735V22.0588H17.55V13.2353H9.45V22.0588H6.75V10.5735L13.5 3.95588ZM13.5 0L0 13.2353H4.05V25H12.15V16.1765H14.85V25H22.95V13.2353H27L13.5 0Z"
                        fill="#EEF5FF" />
                </svg>
                <span>Beranda</span>
            </a>
            <a href="/form-pengaduan" title="Profil" class="active" id="profileLink">
                <!-- Profile Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="27" height="23" viewBox="0 0 27 23" fill="none">
                    <path
                        d="M0 0V3.28571H26.2857V0H0ZM0 6.57143V9.85714H19.7143V6.57143H0ZM0 13.1429V16.4286H26.2857V13.1429H0ZM0 19.7143V23H19.7143V19.7143H0Z"
                        fill="white" />
                </svg>
                <span>Profil</span>
            </a>
            <a href="/about" title="Pencarian" id="searchLink">
                <!-- Search Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="23" viewBox="0 0 22 23" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M14.5801 17.2727C12.7218 18.7041 10.4148 19.3484 8.1213 19.0766C5.82782 18.8049 3.71725 17.637 2.21243 15.8072C0.707605 13.9773 -0.0803286 11.6205 0.0064806 9.20888C0.0932898 6.7973 1.04843 4.50908 2.68055 2.80263C4.31267 1.09618 6.50122 0.0975383 8.80776 0.00677574C11.1143 -0.0839869 13.3684 0.73983 15.1186 2.31319C16.8688 3.88654 17.9858 6.09323 18.2457 8.49116C18.5056 10.8891 17.8894 13.3012 16.5203 15.2441L21.5631 20.5146C21.6979 20.646 21.8061 20.8045 21.8812 20.9805C21.9562 21.1566 21.9965 21.3466 21.9998 21.5394C22.003 21.7321 21.9691 21.9235 21.9001 22.1022C21.831 22.281 21.7283 22.4433 21.5979 22.5796C21.4676 22.7159 21.3123 22.8233 21.1413 22.8955C20.9704 22.9677 20.7873 23.0032 20.603 22.9998C20.4187 22.9964 20.2369 22.9542 20.0685 22.8757C19.9001 22.7973 19.7485 22.6842 19.6229 22.5432L14.5801 17.2727ZM15.5594 9.56795C15.5594 11.3444 14.8844 13.0481 13.683 14.3042C12.4816 15.5604 10.8521 16.2661 9.15302 16.2661C7.45395 16.2661 5.82447 15.5604 4.62304 14.3042C3.42161 13.0481 2.74666 11.3444 2.74666 9.56795C2.74666 7.7915 3.42161 6.08781 4.62304 4.83167C5.82447 3.57552 7.45395 2.86983 9.15302 2.86983C10.8521 2.86983 12.4816 3.57552 13.683 4.83167C14.8844 6.08781 15.5594 7.7915 15.5594 9.56795Z"
                        fill="#EEF5FF" />
                </svg>
                <span>Pencarian</span>
            </a>
        </div>

        <!-- Logout Icon -->
        <a href="/" title="Keluar" class="mt-auto">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="16" viewBox="0 0 15 16" fill="none">
                <path
                    d="M1.70455 16C1.2358 16 0.834659 15.8261 0.501136 15.4782C0.167614 15.1304 0.000568182 14.7117 0 14.2222V1.77778C0 1.28889 0.167045 0.870518 0.501136 0.522667C0.835227 0.174815 1.23636 0.000592592 1.70455 0H6.81818C7.05966 0 7.26222 0.0853334 7.42585 0.256C7.58949 0.426667 7.67102 0.63763 7.67045 0.888889C7.67045 1.14074 7.58864 1.352 7.425 1.52267C7.26136 1.69333 7.05909 1.77837 6.81818 1.77778H1.70455V14.2222H6.81818C7.05966 14.2222 7.26222 14.3076 7.42585 14.4782C7.58949 14.6489 7.67102 14.8598 7.67045 15.1111C7.67045 15.363 7.58864 15.5742 7.425 15.7449C7.26136 15.9156 7.05909 16.0006 6.81818 16H1.70455ZM12.081 8.88889H5.96591C5.72443 8.88889 5.52216 8.80355 5.35909 8.63289C5.19602 8.46222 5.1142 8.25126 5.11364 8C5.11364 7.74815 5.19545 7.53718 5.35909 7.36711C5.52273 7.19704 5.725 7.1117 5.96591 7.11111H12.081L10.483 5.44444C10.3267 5.28148 10.2486 5.08148 10.2486 4.84444C10.2486 4.60741 10.3267 4.4 10.483 4.22222C10.6392 4.04444 10.8381 3.9517 11.0795 3.944C11.321 3.9363 11.527 4.02163 11.6974 4.2L14.7443 7.37778C14.9148 7.55555 15 7.76296 15 8C15 8.23704 14.9148 8.44444 14.7443 8.62222L11.6974 11.8C11.527 11.9778 11.3247 12.0631 11.0906 12.056C10.8565 12.0489 10.654 11.9561 10.483 11.7778C10.3267 11.6 10.2523 11.389 10.2597 11.1449C10.267 10.9007 10.3486 10.6969 10.5043 10.5333L12.081 8.88889Z"
                    fill="#EEF5FF" />
            </svg>
            <span>Keluar</span>
        </a>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-container">
            <!-- Left Card: Form Pengaduan -->
            <div class="content-box">
                <h1>Form Pengaduan</h1>
                <form id="pengaduanForm" action="/form-pengaduan" method="POST">
                    <div class="form-group">
                        <label for="nik">NIK Pengadu</label>
                        <input type="text" id="nik" name="NIK" placeholder="Masukkan NIK Warga" required>
                    </div>
                    <div class="form-group">
                        <label for="nama">Nama Pengadu</label>
                        <input type="text" id="nama" name="nama" placeholder="Masukkan Nama Pengadu" required>
                    </div>
                    <div class="form-group">
                        <label for="alamat">Alamat Pengadu</label>
                        <input type="text" id="alamat" name="alamat" placeholder="Masukkan Alamat Pengadu" required>
                    </div>
                    <div class="form-group">
                        <label for="no_hp">No Hp Pengadu</label>
                        <input type="text" id="no_hp" name="no_hp" placeholder="Masukkan No Hp Pengadu" required>
                    </div>
                    <div class="form-group">
                        <label for="jenis">Jenis Pengaduan</label>
                        <select id="jenis" name="jns_pengaduan" required>
                            <option value="">Pilih Jenis Pengaduan</option>
                            <option value="Kebersihan">Kebersihan</option>
                            <option value="Keaamanan">Keamanan</option>
                            <option value="Fasilitas Umum">Fasilitas Umum</option>
                            <option value="Sosial">Sosial</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="deskripsi">Deskripsi Pengaduan</label>
                        <textarea id="deskripsi" name="desk_pengaduan" placeholder="Masukkan Deskripsi"
                            required></textarea>
                    </div>
                    <button type="submit" class="btn">Simpan</button>
                </form>
            </div>

            <!-- Right Card: Output -->
            <div class="content-box">
                <h1>Hasil Pengaduan</h1>
                <div class="output" id="outputContainer">
                    <p>Hasil inputan akan muncul di sini setelah Anda mengisi form pengaduan.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById("pengaduanForm");
        const outputContainer = document.getElementById("outputContainer");
        let editCard = null;

        form.addEventListener("submit", async function (event) {
            event.preventDefault(); // Mencegah reload halaman

            // Ambil data dari formulir
            const formData = {
                NIK: document.getElementById("nik").value,
                nama: document.getElementById("nama").value,
                alamat: document.getElementById("alamat").value,
                no_hp: document.getElementById("no_hp").value,
                jns_pengaduan: document.getElementById("jenis").value,
                desk_pengaduan: document.getElementById("deskripsi").value,
            };

            try {
                if (editCard) {
                    // Update card jika sedang dalam mode edit
                    const cardContent = editCard.querySelector(".card-content");
                    cardContent.querySelector("h3").textContent = formData.nama;
                    cardContent.querySelector("p:nth-child(2)").innerHTML = `<strong>NIK:</strong> ${formData.NIK}`;
                    cardContent.querySelector("p:nth-child(3)").innerHTML = `<strong>Alamat:</strong> ${formData.alamat}`;
                    cardContent.querySelector("p:nth-child(4)").innerHTML = `<strong>No HP:</strong> ${formData.no_hp}`;
                    cardContent.querySelector("p:nth-child(5)").innerHTML = `<strong>Jenis Pengaduan:</strong> ${formData.jns_pengaduan}`;
                    cardContent.querySelector("p:nth-child(6)").innerHTML = `<strong>Deskripsi:</strong> ${formData.desk_pengaduan}`;

                    // Hapus mode edit
                    editCard = null;
                } else {
                    // Kirim data ke server dengan POST jika mode tambah
                    const response = await fetch('/form-pengaduan', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData),
                    });

                    if (response.ok) {
                        // Jika berhasil, tambahkan data langsung ke UI
                        addToRightCard(formData);
                    } else {
                        console.error("Error submitting data:", await response.text());
                    }
                }

                form.reset(); // Reset form setelah submit
            } catch (error) {
                console.error("Error:", error);
            }
        });

        // Fungsi untuk menambahkan data ke Right Card
        function addToRightCard(data) {
            const card = document.createElement("div");
            card.classList.add("card");
            card.innerHTML = `
                <div class="card-content">
                    <h3>${data.nama}</h3>
                    <p><strong>NIK:</strong> ${data.NIK}</p>
                    <p><strong>Alamat:</strong> ${data.alamat}</p>
                    <p><strong>No HP:</strong> ${data.no_hp}</p>
                    <p><strong>Jenis Pengaduan:</strong> ${data.jns_pengaduan}</p>
                    <p><strong>Deskripsi:</strong> ${data.desk_pengaduan}</p>
                    <p><strong>Status:</strong> <span class="status">Belum Selesai</span></p>
                    <button class="btn-edit">Edit</button>
                    <button class="btn-delete">Hapus</button>
                </div>
                `;
            outputContainer.appendChild(card); // Tambahkan kartu ke container

            //Tambahkan event listener untuk tombol edit
            const editButton = card.querySelector(".btn-edit");
            editButton.addEventListener("click", () => {
                editCardData(card);
            });

            // Tambahkan event listener untuk tombol Hapus
            const deleteButton = card.querySelector(".btn-delete");
            deleteButton.addEventListener("click", () => {
                deleteCard(card);
            });
        }

        // Fungsi untuk menghapus card
        function deleteCard(card) {
            if (confirm("Apakah Anda yakin ingin menghapus data ini?")) {
                card.remove(); // Hapus elemen card dari DOM
            }
        }

        // Fungsi untuk mengedit card
        function editCardData(card) {
            // Ambil data dari card yang akan diedit
            const cardContent = card.querySelector(".card-content");
            const nama = cardContent.querySelector("h3").textContent;
            const NIK = cardContent.querySelector("p:nth-child(2)").textContent.split(": ")[1];
            const alamat = cardContent.querySelector("p:nth-child(3)").textContent.split(": ")[1];
            const no_hp = cardContent.querySelector("p:nth-child(4)").textContent.split(": ")[1];
            const jns_pengaduan = cardContent.querySelector("p:nth-child(5)").textContent.split(": ")[1];
            const desk_pengaduan = cardContent.querySelector("p:nth-child(6)").textContent.split(": ")[1];

            // Isi data ke form
            document.getElementById("nik").value = NIK;
            document.getElementById("nama").value = nama;
            document.getElementById("alamat").value = alamat;
            document.getElementById("no_hp").value = no_hp;
            document.getElementById("jenis").value = jns_pengaduan;
            document.getElementById("deskripsi").value = desk_pengaduan;

            // Simpan elemen card yang akan diedit
            editCard = card;
        }
    </script>
</body>

</html>